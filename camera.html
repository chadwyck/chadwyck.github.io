<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title></title>
</head>
<body>
<div id="contain">
  <div class="cont" id="cont1">
  <video id="video" autoplay></video>
  <canvas id="canvas" width="0" height="0"></canvas>
  </div>
  <div class="cont" id="cont2">
  <!--<video id="video2" autoplay></video>-->
  <canvas id="canvas2" width="0" height="0"></canvas>
  </div>
</div>

<style type="text/css">
  html, body {
    margin: 0;
    background-color: #000;
  }
  video {
    min-width: 50vw;
    min-height: 100vw;
    position: absolute;
    top: -9999px;
    bottom: -9999px;
    left: -9999px;
    right: -9999px;
    margin: auto;
  }
  .cont canvas {
    min-width: 50vw;
    min-height: 100vw;
    position: absolute;
    top: -9999px;
    bottom: -9999px;
    left: -9999px;
    right: -9999px;
    margin: auto;
  }
  .cont {
    min-width: 50vw;
    min-height: 100vw;
    position: fixed;
    text-align: center;
    overflow: hidden;
  }
  #contain {
    width: 100vw;
    height: 100vh;
  }
  #cont1 {
    top: 0;
    left: 0;
  }
  #cont2 {
    top: 0;
    left: 50vw;
  }
</style>

<script type="text/javascript">
  // Put event listeners into place
  window.addEventListener("DOMContentLoaded", function() {
    // Grab elements, create settings, etc.
    var canvas = document.getElementById("canvas"),
      canvas2 = document.getElementById("canvas2"),
      context = canvas.getContext("2d"),
      context2 = canvas2.getContext("2d"),
      video = document.getElementById("video"),
      videoObj = { "video": true },
//      video2 = document.getElementById("video2"),
//      videoObj2 = { "video": true },
      errBack = function(error) {
        console.log("Video capture error: ", error.code);
      };

    console.log(MediaStreamTrack.getSources(function(media_sources) {

      var videoSources = [];

      media_sources.forEach(function(media_source){
        if (media_source.kind === 'video') {
          videoSources.push(media_source);
        }
      });

      var constraints = {};

      if(videoSources.length > 1) {
        constraints.video = {
          optional: [{sourceId: videoSources[1].id}]
        };
      } else {
        constraints.video = {
          optional: [{sourceId: videoSources[0].id}]
        };
      }

      // Put video listeners into place
      if (navigator.getUserMedia) { // Standard
        navigator.getUserMedia(constraints, videoObj, function (stream) {
          video.src = stream;
          video.play();
        }, errBack);
//        navigator.getUserMedia(constraints, videoObj2, function (stream) {
//          video2.src = stream;
//          video2.play();
//        }, errBack);
      } else if (navigator.webkitGetUserMedia) { // WebKit-prefixed
        navigator.webkitGetUserMedia(constraints, function (stream) {
          video.src = window.webkitURL.createObjectURL(stream);
          video.play();
        }, errBack);
//        navigator.webkitGetUserMedia(constraints, function (stream) {
//          video2.src = window.webkitURL.createObjectURL(stream);
//          video2.play();
//        }, errBack);
      }
      else if (navigator.mozGetUserMedia) { // Firefox-prefixed
        navigator.mozGetUserMedia(constraints, videoObj, function (stream) {
          video.src = window.URL.createObjectURL(stream);
          video.play();
        }, errBack);
//        navigator.mozGetUserMedia(constraints, videoObj2, function (stream) {
//          video2.src = window.URL.createObjectURL(stream);
//          video2.play();
//        }, errBack);
      }
    }));

    document.getElementById("contain").addEventListener('click', fullscreen, false);

    // EFFECTS!!!

    var isMobile = {
      Android: function() {
        return navigator.userAgent.match(/Android/i);
      },
      BlackBerry: function() {
        return navigator.userAgent.match(/BlackBerry/i);
      },
      iOS: function() {
        return navigator.userAgent.match(/iPhone|iPad|iPod/i);
      },
      Opera: function() {
        return navigator.userAgent.match(/Opera Mini/i);
      },
      Windows: function() {
        return navigator.userAgent.match(/IEMobile/i);
      },
      any: function() {
        return (isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows());
      }
    };

//    if(!isMobile.any()) {

      var back = document.createElement('canvas');
      var backcontext = back.getContext('2d');

      var back2 = document.createElement('canvas');
      var backcontext2 = back2.getContext('2d');

      var cw, ch;

      video.addEventListener('play', function () {
        cw = video.clientWidth;
        ch = video.clientHeight;
        canvas.width = cw;
        canvas.height = ch;
        canvas2.width = cw;
        canvas2.height = ch;
        back.width = cw;
        back.height = ch;
        draw(video, context, backcontext, cw, ch);
        back2.width = cw;
        back2.height = ch;
        draw(video, context2, backcontext2, cw, ch);
      }, false);

//      video2.addEventListener('play', function () {
//        cw = video2.clientWidth;
//        ch = video2.clientHeight;
//        canvas2.width = cw;
//        canvas2.height = ch;
//        back2.width = cw;
//        back2.height = ch;
//        draw(video2, context2, backcontext2, cw, ch);
//      }, false);
//    }

  }, false);

  function fullscreen() {
    container = document.getElementById("contain");
    if (container.requestFullscreen) {
      container.requestFullscreen();
    } else if (container.msRequestFullscreen) {
      container.msRequestFullscreen();
    } else if (container.mozRequestFullScreen) {
      container.mozRequestFullScreen();
    } else if (container.webkitRequestFullscreen) {
      container.webkitRequestFullscreen();
    }
  }

  var t = 0;
  var n = 0;
  var si = true;

  function draw(v,c,bc,w,h) {
    if(v.paused || v.ended) return false;

    if(si) {
      n = n + 0.05;
      if(n>=20)
        si = !si;
    } else {
      n = n - 0.05;
      if(n<=0)
        si = !si;
    }

    t = Math.sin(n) * 40;

    // First, draw it into the backing canvas
    bc.drawImage(v,0,0,w,h);
    // Grab the pixel data from the backing canvas
    var idata = bc.getImageData(0,0,w,h);
    var data = idata.data;
    // Loop through the pixels, turning them grayscale
    for(var i = 0; i < data.length; i+=4) {
//      var r = data[i] + t;
//      var g = data[i+1] + t;
//      var b = data[i+2] + t;
//      var brightness = (3*r+4*g+b)>>>3;
//      data[i] = brightness;
//      data[i+1] = brightness;
//      data[i+2] = brightness;
      data[i] = data[i] + t;
      data[i+1] = data[i+1] - t;
      data[i+2] = data[i+2] - t;
    }
    idata.data = data;
    // Draw the pixels onto the visible canvas
    c.putImageData(idata,0,0);
    // Start over!
    setTimeout(function(){ draw(v,c,bc,w,h); }, 0);
  }

</script>

</body>
</html>